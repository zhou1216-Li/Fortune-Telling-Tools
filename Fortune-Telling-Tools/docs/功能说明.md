# 命理预测工具 - 功能说明文档

## 已实现功能 ✅

### 1. 个人化推荐系统 ✅
- **功能描述**：基于用户的历史运势预测和反馈数据，推荐个性化的内容或建议
- **实现方式**：
  - 根据运势预测分数（财运、感情运、事业运、健康运）生成推荐
  - 如果运势较差（分数<40），推荐相关的财务管理、情感建议、职业发展、健康管理等内容
  - 支持根据用户反馈文本进行推荐
- **使用位置**：分析预测页面，在分析结果中显示"个人化推荐"卡片

### 2. 多命理学分析支持 ✅
- **功能描述**：除了星座和MBTI分析，增加其他命理学分析方法
- **实现内容**：
  - **八字分析**：根据生日和出生时辰计算八字，分析五行分布和性格特点
  - **塔罗牌占卜**：抽取3张塔罗牌（过去、现在、未来），提供占卜解读
- **使用位置**：分析预测页面，可选启用八字分析和塔罗牌占卜

### 3. 情感分析与情绪预测 ✅
- **功能描述**：分析用户的情感状态，并预测未来可能的情绪波动
- **实现方式**：
  - 基于关键词识别情感类型（积极、消极、焦虑、愤怒、平静、疲惫、孤独、迷茫）
  - 根据情感类型提供情绪预测和建议
  - 支持情绪趋势分析
- **模块位置**：`modules/emotion_analysis.py`
- **使用位置**：可在心理聊天页面集成使用

### 4. 每日/每周运势推送 ⏳
- **功能描述**：定期为用户推送每日或每周的运势信息
- **状态**：模块已创建，需要配置邮件/短信服务
- **实现方式**：
  - 需要配置邮件服务（如SendGrid）或短信服务（如Twilio）
  - 需要定时任务（如Celery或APScheduler）
  - 需要用户注册和订阅功能
- **待实现**：邮件/短信服务集成、定时任务配置、用户订阅功能

### 5. 匹配度分析 ✅
- **功能描述**：根据星座和MBTI进行情感匹配度、生活匹配度、事业匹配度分析
- **实现内容**：
  - 星座匹配度分析（情感、生活、事业）
  - MBTI匹配度分析（情感、生活、事业）
  - 综合匹配度分析（星座和MBTI各占50%权重）
  - 可视化图表展示
- **使用位置**：匹配度分析页面（`/compatibility`）

### 6. 心理健康分析 ✅
- **功能描述**：根据用户提供的MBTI类型或心理状态，生成心理健康分析报告
- **实现内容**：
  - 基于MBTI类型的心理健康特征分析
  - 识别心理优势和潜在风险
  - 提供压力应对建议
  - 提供情绪管理技巧
  - 总体评估和建议
- **使用位置**：分析预测页面，自动显示在分析结果中

### 7. 可视化分析结果 ✅
- **功能描述**：通过图表和数据可视化工具展示分析结果
- **实现内容**：
  - 使用Plotly生成匹配度分析柱状图
  - 使用Plotly生成运势预测柱状图
  - 图表支持颜色编码（根据分数等级）
  - 图表支持交互式查看
- **使用位置**：
  - 分析预测页面：运势预测图表
  - 匹配度分析页面：匹配度分析图表

### 8. 社交分享功能 ⏳
- **功能描述**：允许用户将自己的分析结果分享到社交平台
- **状态**：需要集成社交平台SDK
- **实现方式**：
  - 需要集成微信SDK、微博SDK等
  - 需要生成分享链接和分享图片
  - 需要配置社交平台的App ID和Secret
- **待实现**：社交平台SDK集成、分享功能实现

### 9. 运势预测与行动计划 ✅
- **功能描述**：不仅提供运势预测，还能基于运势结果生成行动计划
- **实现内容**：
  - 根据各运势类型（财运、感情运、事业运、健康运）的分数生成具体行动计划
  - 提供综合建议
  - 行动计划包括具体的行动步骤和建议
- **使用位置**：分析预测页面，在分析结果中显示"行动计划"卡片

### 10. 多语言支持 ⏳
- **功能描述**：为不同语言的用户提供支持
- **状态**：已添加Flask-Babel依赖，需要配置翻译文件
- **实现方式**：
  - 需要创建翻译文件（.po文件）
  - 需要配置Flask-Babel
  - 需要在模板中使用`_()`函数标记需要翻译的文本
- **待实现**：翻译文件创建、Flask-Babel配置、模板国际化

## 功能使用指南

### 分析预测功能
1. 访问主页或分析预测页面
2. 输入基本信息：
   - 姓名（必填）
   - 生日（必填）
   - MBTI类型（必填）
   - 出生时辰（可选，用于八字分析）
3. 输入可选信息：
   - 居住方位（可选，用于风水分析）
   - 房屋朝向（可选，用于风水分析）
4. 选择其他命理分析：
   - 启用八字分析（可选）
   - 启用塔罗牌占卜（可选）
5. 点击"开始全面分析"按钮
6. 查看分析结果：
   - 星座分析
   - MBTI分析
   - 运势预测（带图表）
   - 心理健康分析
   - 个性化推荐
   - 行动计划
   - 风水分析（如果提供了信息）
   - 八字分析（如果启用）
   - 塔罗牌占卜（如果启用）

### 匹配度分析功能
1. 访问匹配度分析页面
2. 输入第一人信息：
   - 姓名（必填）
   - 生日（必填）
   - MBTI类型（必填）
3. 输入第二人信息：
   - 姓名（必填）
   - 生日（必填）
   - MBTI类型（必填）
4. 点击"开始匹配度分析"按钮
5. 查看匹配度分析结果：
   - 综合匹配度
   - 情感匹配度
   - 生活匹配度
   - 事业匹配度
   - 详细分析
   - 可视化图表

### 心理聊天功能
1. 访问心理聊天页面
2. 在输入框中输入消息
3. 点击"发送"按钮
4. 查看AI回复
5. 可以继续对话
6. 点击"清空聊天"按钮清空聊天记录

### 历史记录功能
1. 访问历史记录页面
2. 查看所有历史分析记录
3. 点击记录查看详细信息
4. 在详情页面可以提交反馈

## 技术实现说明

### 模块结构
- `modules/zodiac.py` - 星座分析模块
- `modules/mbti.py` - MBTI分析模块
- `modules/fortune.py` - 运势预测模块
- `modules/fengshui.py` - 风水分析模块
- `modules/compatibility.py` - 匹配度分析模块
- `modules/visualization.py` - 可视化模块
- `modules/mental_health.py` - 心理健康分析模块
- `modules/recommendation.py` - 个性化推荐模块
- `modules/action_plan.py` - 行动计划模块
- `modules/emotion_analysis.py` - 情感分析模块
- `modules/divination.py` - 多命理学分析模块（八字、塔罗牌）
- `modules/chat_assistant.py` - 聊天助手模块
- `database/db_manager.py` - 数据库管理模块

### 数据库结构
- `users` 表：存储用户信息
- `analysis_history` 表：存储分析历史记录

### 依赖包
- `Flask>=2.3.0` - Web框架
- `requests>=2.31.0` - HTTP请求库
- `plotly>=5.17.0` - 可视化库
- `pandas>=2.0.0` - 数据处理库
- `Flask-Babel>=3.0.0` - 多语言支持库

## 待实现功能

### 1. 每日/每周运势推送
- 需要配置邮件/短信服务
- 需要定时任务
- 需要用户订阅功能

### 2. 社交分享功能
- 需要集成社交平台SDK
- 需要生成分享链接和图片

### 3. 多语言支持
- 需要创建翻译文件
- 需要配置Flask-Babel
- 需要模板国际化

## 注意事项

1. **八字分析**：当前的八字计算使用简化算法，实际八字计算更复杂，建议用于娱乐目的
2. **塔罗牌占卜**：塔罗牌占卜结果基于随机抽取，仅供参考
3. **匹配度分析**：匹配度分析基于通用的星座和MBTI匹配规则，实际关系还需考虑多种因素
4. **心理健康分析**：心理健康分析基于MBTI类型特征，如有严重心理问题，建议寻求专业帮助
5. **AI聊天**：AI聊天功能使用免费API，回复质量可能有限

## 更新日志

### 2024-01-XX
- ✅ 实现匹配度分析功能
- ✅ 实现可视化图表功能
- ✅ 实现心理健康分析功能
- ✅ 实现多命理学分析支持（八字、塔罗牌）
- ✅ 实现个性化推荐系统
- ✅ 实现行动计划生成功能
- ✅ 实现情感分析模块
- ✅ 优化用户界面和用户体验

