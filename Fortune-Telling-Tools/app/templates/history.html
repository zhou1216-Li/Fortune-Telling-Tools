{% extends "index.html" %}

{% block content %}
<!-- å†å²è®°å½•æ ‡ç­¾é¡µ -->
<div class="tab-content active">
    <div class="card">
        <h2>ğŸ“œ å†å²è®°å½•</h2>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <a href="{{ url_for('main.history') }}" class="btn-secondary" style="text-decoration: none; display: inline-block;">åˆ·æ–°</a>
            {% if history_list %}
            <span style="color: #666; font-size: 14px;">å…± {{ history_list|length }} æ¡è®°å½•</span>
            {% endif %}
        </div>
        
        {% if success_message %}
        <div class="success-message">{{ success_message }}</div>
        {% endif %}
        
        {% if error_message %}
        <div class="error-message">{{ error_message }}</div>
        {% endif %}
        
        {% if error %}
        <div class="error-message">{{ error }}</div>
        {% endif %}
        
        <div id="history-list" style="margin-top: 20px;">
            {% if history_list %}
                {% for record in history_list %}
                <div class="history-item">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <a href="{{ url_for('main.view_history', history_id=record.id) }}" style="text-decoration: none; color: inherit; flex: 1;">
                            <h3>{{ record.name }}</h3>
                            <p>{{ record.zodiac }} | {{ record.mbti }} | {{ record.created_at }}</p>
                        </a>
                        <form method="POST" action="{{ url_for('main.delete_history', history_id=record.id) }}" 
                              onsubmit="return confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼');" 
                              style="margin-left: 15px;">
                            <button type="submit" class="btn-delete" title="åˆ é™¤è®°å½•">ğŸ—‘ï¸</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p style="text-align: center; color: #666; padding: 40px;">æš‚æ— å†å²è®°å½•</p>
            {% endif %}
        </div>
    </div>
</div>

<script>
// è‡ªåŠ¨éšè—æˆåŠŸ/é”™è¯¯æ¶ˆæ¯
document.addEventListener('DOMContentLoaded', function() {
    const successMessage = document.querySelector('.success-message');
    const errorMessage = document.querySelector('.error-message');
    
    if (successMessage) {
        setTimeout(function() {
            successMessage.style.transition = 'opacity 0.5s';
            successMessage.style.opacity = '0';
            setTimeout(function() {
                successMessage.remove();
            }, 500);
        }, 3000);
    }
    
    if (errorMessage) {
        setTimeout(function() {
            errorMessage.style.transition = 'opacity 0.5s';
            errorMessage.style.opacity = '0';
            setTimeout(function() {
                errorMessage.remove();
            }, 500);
        }, 5000);
    }
});
</script>
{% endblock %}
